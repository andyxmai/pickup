{% extends "base.html" %}

{% block title %}{{player.first_name}} {{player.last_name}}{%endblock%}

{% block navlist %}
        <li><a href="/"><i class="fa fa-home fa-lg"></i>&nbsp;Home</a></li>
        {% if loggedinUser == player %}
            <li class="active"><a href="/profile"><i class="fa fa-user fa-lg"></i>&nbsp;Profile</a></li>
        {% else %}
            <li class=""><a href="/profile"><i class="fa fa-user fa-lg"></i>&nbsp;Profile</a></li>
        {% endif %}
        <li><a href="/analytics"><i class="fa fa-bullseye fa-lg"></i>&nbsp;Analytics</a></li>
        <li><a href="/logout"><i class="fa fa-external-link fa-lg"></i>&nbsp;Logout</a></li>
{% endblock %}

{% block content %}
<!-- Facebook SDK -->
<div id="fb-root"></div>
<!-- Facebook photo selector modal -->
<div id="facebook_photo_selector" class="modal fade fb-photo">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="color:gray">&times;</button>
                <h4 class="modal-title">Choose a photo</h4>
            </div>
            <div class="modal-body">
                <form>
                <div class="form">
                    <label>Select Facebook Album:</label>
                    <select class="fbps-albums" name="facebook_photo_album"></select>
                </div>
                    <div class="fbps-photos clearfix"></div>
                 </form>
            </div>
            <div class="modal-footer">
               <!--  <button type="button" class="btn btn-default fbps-cancel" data-dismiss="modal">Close</button> -->
                <button type="button" class="btn btn-primary fbps-select" data-dismiss="modal" id="fb_photo_select">Select Photo</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- END Facebook photo selector modal -->

<section class= "overlay" style="background-image: url(http://www.lyft.com/images/bg-quilt.png); overflow:scroll" >
  <div class="container">
    <div class="prof-info col-md-3">
    <h2>{{player.first_name}} {{player.last_name}}</h2>
    <img id="prof-pic" src="{{player.userinfo.profile_picture}}">
    <br></br>
    {% if player.id == loggedinUser.id %}   
        <div>
            <a data-toggle="modal" href="#facebook_photo_selector" type="button" class="btn btn-facebook" style="position: relative; z-index:2">
                <i class="fa fa-facebook"></i> | Upload Photo</a>
        </div> 
        {% if not connected_to_instagram %}
        <a type="button" class="btn btn-instagram instagram" href='https://api.instagram.com/oauth/authorize/?client_id={{instagramID}}&redirect_uri={{redirectURL}}&response_type=code'>
            <i class="fa fa-camera-retro"></i> | Connect to Instagram
        </a>
        {% else %}
        <a type="button" class="btn btn-instagram instagram" href='https://api.instagram.com/oauth/authorize/?client_id={{instagramID}}&redirect_uri={{redirectURL}}&response_type=code' disabled="disabled">
        <i class="fa fa-camera-retro"></i> | Connected to Instagram
        </a>
        {% endif %}
    {% else %}
        {% if is_following %}
        <div>
            <button type="button" class="btn btn-default follow">UnFollow</button>
        </div> 
        {% else %}
        <div>
            <button type="button" class="btn btn-default follow">Follow</button>
        </div> 
        {% endif %}
    {% endif %}


    <p><a href="mailto:{{player.username}}"><i class="fa fa-envelope fa-lg"></i>&nbsp;{{player.username}}</a></p>
        <div>
            {{following}}
        </div>
    </div>


    <div class="games-feed col-md-8">
        
        <h3>Upcoming Games</h3>
        <table id="games">
            {% for game in upcoming_games %}
            <tr class="{% cycle 'odd' 'even' %}"><td>
        <div class="single-game">     
        <div class="accordion" id="accordion{{game.id}}">
            <div class="accordion-group">
             <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion{{game.id}}" href="#collapse{{game.id}}"> 
                    <h5 class="game-name">
                        <i class="fa fa-dribbble fa-lg"></i> &nbsp;{{game.name}} ({{game.timeStart.date}})
                        <span class="arrow"><i class="fa fa-chevron-down fa-xs"></i></span>
                    </h5>
                </a>
                <div id="collapse{{game.id}}" class="accordion-body collapse">
                        <div class="details-left col-md-6">
                            <p><b>Sport:</b> {{game.sport}}</p>
                            <p><b>Description:</b> {{game.description}}</p>
                            <p><b>Start Time:</b> {{game.timeStart.time}}</p>
                        </div>
                        <div class="details-right col-md-6">
                            <p><b>Location:</b> {{game.location}}</p>   
                            <p><b>Max Players:</b> {{game.cap}}</p>
                            <p><b>Creator:</b> {{game.creator}}</p>
                        </div>
                        <div class="col-md-12">
                            <a href="/game/{{game.id}}">See More</a>
                        </div>
                    </div>
                {% endfor %}
                </div>
                </div>
            </div>
    </div></td></tr>
</table>


<h3>Game History</h3>
        <table id="games">
            {% for game in games_played %}
            <tr class="{% cycle 'odd' 'even' %}"><td>
        <div class="single-game">     
        <div class="accordion" id="accordion{{game.id}}">
            <div class="accordion-group">
             <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion{{game.id}}" href="#collapse{{game.id}}"> 
                    <h5 class="game-name">
                        <i class="fa fa-dribbble fa-lg"></i> &nbsp;{{game.name}} ({{game.timeStart.date}})
                        <span class="arrow"><i class="fa fa-chevron-down fa-xs"></i></span>
                    </h5>
                </a>
                <div id="collapse{{game.id}}" class="accordion-body collapse">
                        <div class="details-left col-md-6">
                            <p><b>Sport:</b> {{game.sport}}</p>
                            <p><b>Description:</b> {{game.description}}</p>
                            <p><b>Start Time:</b> {{game.timeStart.time}}</p>
                        </div>
                        <div class="details-right col-md-6">
                            <p><b>Location:</b> {{game.location}}</p>   
                            <p><b>Max Players:</b> {{game.cap}}</p>
                            <p><b>Creator:</b> {{game.creator}}</p>
                        </div>
                        <div class="col-md-12">
                            <i class="fa fa-info fa-xs"></i><a href="/game/{{game.id}}">&nbsp;<b>{{game.name}} Page</b></a>
                        </div>
                    </div>
                {% endfor %}
                </div>
                </div>
            </div>
    </div></td></tr>
</table>

</section>
{%endblock%}
{% block javascript %}
<script>

    $(".follow").click(function(){
        $.ajax({
            type: "POST",
            url:"/toggle_follow/",
            data: {
                'csrfmiddlewaretoken':'{{csrf_token}}',
                'player' : "{{player.username}}"
            },
            success: function(data){
                console.log(data)
                // console.log(data['follow'])
                console.log("posting html")
                // var is_following = data['follow']
                // console.log(is_following)
                // if is_following == "Yes":
                //      $(".follow").html("Unfollow")
                // else:
                //     $(".follow").html("Follow")
            }
        });
    });

    $(function()
    {
        $.getScript('//connect.facebook.net/en_US/all.js', function()
        {
            FB.init({
                appId      : '{{facebookID}}',
                channelUrl : '{{websiteURL}}',
                status     : true,
                xfbml      : false
            });

            FacebookPhotoSelector.setFacebookSDK(FB);
        });

        $('#facebook_photo_selector').facebookPhotoSelector({
            onFinalSelect : function(photos)
            {
                //console.log(photos);
                if (photos.length) {
                    var photo_url = photos[0];
                    $.ajax({
                    type: "POST",
                    url: "/upload_profile_photo/",
                    data: { 
                        'photo_url': photo_url,
                        'csrfmiddlewaretoken':'{{csrf_token}}' 
                    },
                    success: function(data) {
                        window.location.href = "/profile"
                    },
                  });
                }
            }
        });
    });
</script>
{% endblock %}